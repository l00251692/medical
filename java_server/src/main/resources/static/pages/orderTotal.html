<!doctype html>
<html>
<meta charset="utf-8">
<head>
  <meta http-equiv="Content-type" content="text/html" />
  <meta name="title" content="foryou" />
  <meta name="language" content="zh" />
  <title>订单汇总</title>
  <link rel="stylesheet" href="../css/order.css">
  <link rel="stylesheet" href="../css/bootstrap-datepicker3.css">
  <link rel="stylesheet"
  href="../css/bootstrap-datepicker3.standalone.css">
  <link rel="icon" href="/favicon.ico?v=2" type="image/x-icon" />
  <link id="bs-css"
  href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css"
  rel="stylesheet">
  <link rel="shortcut icon" href="../img/icon.png" type="image/x-icon" />
  <script src="//code.jquery.com/jquery-1.9.1.min.js"></script>
  <script type="text/javascript" src="../js/bootstrap-datepicker.js"></script>
  <script type="text/javascript"
  src="../js/bootstrap-datepicker.zh-CN.min.js"></script>
  <script src="../js/util.js"></script>
  <style type="text/css">
    #content {
     padding: 0px;
   }

   .list_panel input.datepicker {
     width: 116px;
   }
   #select{
     background: #FF4500;
     color: #fff;
     border:1px solid #ff4500;
   }
   div.head-color{
    background-color: #FAFAFA;
   }

 </style>
</head>
<body>
	<section id="content">
		<div class="g5 list_panel no_dine main_container" id="list_panel">
			<div class="title_and_filter head-color">
				<h2 name="counts">订单列表</h2>
				<form  id="order_center_filter">
					<span class="ml10">选择日期：</span> <span> <input type="text" value=""
          id="datepicker" class="datepicker">
        </span> <input type="button" id="select" value="查询" class="submit" />
      </form>
    </div>

    <div class="order_filter_summary">
      <span class="fr mr30"> <a class="blue"
       style="padding: 2px; margin-right: 5px;">1</a>
     </span> 共计：<span name="counts"></span> 张有效订单
   </div>

   <div id="list_container">
    <ul id="list_items">
    </ul>
  </div>
</div>
</section>
<script>
  $('#datepicker').datepicker({
   todayBtn : "linked",
   language : "zh-CN",
   autoclose : true,
 });

  $(function() {
    $('#datepicker').val(time());
        getTotalDate(null);

    $("#select").on("click",function(){
      $("#list_items").text("");
      getTotalDate($("#datepicker").val());
    });
  });


	function getTotalDate(datetime) {

		var campusId = getCookie("campusId");
		//alert(campusId);
		$.post("../order/getOrdersByDate", {
			date : datetime,
			server:"56846a8a2fee49d14901d39cc48b8b2a"
		}, function(text) {
			var data = eval(text);
            console.log("getTotalDate:" + JSON.stringify(data));
			$("h2[name='counts']").text("订单列表(" + data.counts + ")");
			$("span[name='counts']").text(data.counts);

			for (var i = data.orderList.length - 1; i >= 0; i--) {
				formatList(data.orderList[i], i + 1);
			}

		});

	}

	function formatList(data, i) {
		$.get("togetherOrderDetail.txt", function(text) {
			text = text.replace(/(orderId##)/g, data.order_id).replace(
					/(date##)/g, data.create_time).replace(/(name##)/g,
					data.name).replace(/(phone##)/g,
					data.phone).replace(/(idcard##)/g,
                    data.idcard).replace(/(hospital##)/g,
                    data.hospital).replace(/(mrNo##)/g,
                    data.mrNo).replace(/(department##)/g,
                    data.department).replace(/(doctor##)/g,
                    data.doctor).replace(/(bedNo##)/g,
                    data.bedNo).replace(/(address##)/g,
                    data.addr).replace(/(index##)/g, i);

            if(data.nick_name == null)
            {
                text = text.replace(/(nickName##)/g, "");
            }
            else{
                text = text.replace(/(nickName##)/g, data.nick_name);
            }
			//判断订单状态
            if (data.status == "1") {
                text = text.replace(/(orderStatus##)/g, "待支付");
            }       //
			else if (data.status == 2 ) {
				text = text.replace(/(orderStatus##)/g, "待配送");
			} else if (data.status == 3) {
				text = text.replace(/(orderStatus##)/g, "已配送");
			}else{
                console.log("status1:");
				text = text.replace(/(orderStatus##)/g, "");
			}

			$("#list_items").append(text);

		});
	};

	function time()
	{
		var now = new Date();
		var year = now.getFullYear();
		var month = now.getMonth() + 1;
		var date = now.getDate();
		if (month < 10)
			month = "0" + month;
		if (date < 10)
			date = "0" + date;
		//写入相应id

		return year + "年" + (month) + "月" + date + "日";
	}
</script>
</body>
</html>